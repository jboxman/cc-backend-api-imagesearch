{"version":3,"sources":["webpack:///webpack/bootstrap b7f80fdf3fce8f0c66c6","webpack:///external \"object-assign\"","webpack:///external \"ramda\"","webpack:///./server/app.js","webpack:///external \"dotenv\"","webpack:///./server/globals.js","webpack:///./server/helpers/api.js","webpack:///./server/models/search.js","webpack:///./tools/index.js","webpack:///external \"axios\"","webpack:///external \"body-parser\"","webpack:///external \"express\"","webpack:///external \"querystring\"","webpack:///external \"redis\"","webpack:///external \"util\"","webpack:///./app.js"],"names":["express","require","bodyParser","util","redis","globals","api","searchModel","module","exports","app","port","process","env","PORT","client","createClient","url","REDIS_URL","model","use","static","cwd","json","get","req","res","next","query","q","offset","status","send","isNaN","err","result","Error","saveRecent","reply","getRecent","console","error","stack","server","listen","log","HEROKU_URL","NODE_ENV","qs","objectAssign","R","axios","renameKeys","API_ENDPOINT","CX","API_KEY","GOOGLE_API_KEY","transformData","data","getKeys","pipe","pick","cacheId","getThumb","path","thumbs","width","height","src","getImage","image","r","reduce","acc","item","items","length","ids","v","id","cb","params","stringify","start","cx","key","fileType","compositeURL","then","response","catch","redis_ds_RECENT","redis_ds_COUNT","redis_ds_QUERY","config","emptyFn","doUpdate","logItem","fn","getClient","serializedItem","JSON","watch","count","nextTick","multi","incr","lpush","set","exec","lrange","mget","map","vals","parse","when","Date","now","curry","keysMap","obj","keys","dotenv","load"],"mappings":"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","file":"backend.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b7f80fdf3fce8f0c66c6","module.exports = require(\"object-assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"object-assign\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"ramda\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ramda\"\n// module id = 1\n// module chunks = 0","const express = require('express');\nconst bodyParser = require('body-parser');\nconst util = require('util');\nconst redis = require('redis');\n\nconst globals = require('./globals');\nconst api = require('./helpers/api');\nconst searchModel = require('./models/search');\n\n// For testing:\n// https://glebbahmutov.com/blog/how-to-correctly-unit-test-express-server/\nmodule.exports = function() {\n  const app = express();\n  const port = process.env.PORT || 3100;\n\n//  const client = redis.createClient({url: globals.REDIS_URL});\n  const client = redis.createClient({\n    url: globals.REDIS_URL\n  });\n  const model = searchModel({client});\n\n  // __dirname is '/' after babel\n  app.use(express.static(`${process.cwd()}/public`));\n\n  app.use(bodyParser.json());\n\n// TODO\n// Should this be \"offset\" because of specific user story? Yes.\n  app.get('/api/search', (req, res, next) => {\n   let {q, offset} = req.query;\n\n   if(!q) {\n     res.status(400).send('API error: Missing q');\n     return;\n   }\n   if(!offset) {\n     offset = 1;\n   }\n   else if(isNaN(offset)) {\n     res.status(400).send('API error: Bad offset');\n     return;\n   }\n\n    api({q, offset}, function(err, result) {\n      if(err) {\n        next(new Error(err));\n        return;\n      }\n\n      model.saveRecent(q, (err, reply) => {\n        res.status(200).json(result);\n      });\n    });\n\n  });\n\n  app.get('/api/recent', (req, res) => {\n    model.getRecent((err, reply) => {\n      res.status(200).json(reply);\n    });\n  });\n\n  app.use(function(req, res, next) {\n    res.status(404).send('Not Found');\n  });\n\n  app.use(function(err, req, res, next) {\n    console.error(err.stack);\n    res.status(500).send('error');\n  });\n\n  const server = app.listen(port, () => console.log(`Listening on ${port}`));\n  return server;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/app.js","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 3\n// module chunks = 0","const REDIS_URL = process.env.REDIS_URL ? process.env.REDIS_URL : null;\nconst HEROKU_URL = (process.env.NODE_ENV == 'production') ? process.env.HEROKU_URL : 'http://localhost/';\n\nmodule.exports = {\n  REDIS_URL,\n  HEROKU_URL\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/globals.js","const qs = require('querystring');\nconst objectAssign = require('object-assign');\nconst R = require('ramda');\nconst axios = require('axios');\nconst {get} = axios;\n\nconst renameKeys = require('../../tools').renameKeys;\n\nconst API_ENDPOINT = 'https://www.googleapis.com/customsearch/v1';\nconst CX = '014304067697241665025:k9zlrt4v4bw';\n// .env locally and in config on Heroku\nconst API_KEY = process.env.GOOGLE_API_KEY;\n\nfunction transformData(data) {\n  const getKeys = R.pipe(\n    R.pick(['title', 'cacheId', 'snippet', 'displayLink']),\n    renameKeys({\n      cacheId: 'id'\n    })\n  );\n\n  // TODO\n  // Add default when missing?\n  const getThumb = R.pipe(\n    R.path(['pagemap', 'cse_thumbnail']),\n    thumbs => thumbs ? thumbs[0] : {},\n    R.pick(['width', 'height', 'src']),\n    renameKeys({\n      width: 'thumb_width',\n      height: 'thumb_height',\n      src: 'thumb_src'\n    })\n  );\n\n  const getImage = R.pipe(\n    R.path(['pagemap', 'cse_image']),\n    image => image ? image[0] : {},\n    R.pick(['src']),\n    renameKeys({\n      src: 'image_src'\n    })\n  );\n\n  const r = R.reduce((acc, item) => {\n    return [\n      ...acc,\n      objectAssign(\n        {},\n        getKeys(item),\n        getThumb(item),\n        getImage(item))\n      ];\n  }, [], data.items);\n\n  return {\n    length: r.length,\n    items: r,\n    ids: R.reduce((acc, v) => [...acc, v.id], [], r)\n  };\n}\n\nmodule.exports = function({q, offset} = {}, cb) {\n  if(!q) {\n    cb(new Error('Must specify q'));\n    return;\n  }\n\n  const params = qs.stringify({\n    q,\n    start: offset,\n    cx: CX,\n    key: API_KEY,\n    fileType: 'jpg'\n  });\n\n  const compositeURL = `${API_ENDPOINT}?${params}`;\n\n  get(compositeURL)\n    .then(response => {\n      cb(null, transformData(response.data));\n    })\n    .catch(error => {\n      console.log(error);\n      cb(error);\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/helpers/api.js","// Simple model with redis\n// http://blog.arunaherath.com/2014/06/faking-redis-in-nodejs-with-fakeredis.html\n\nconst objectAssign = require('object-assign');\n\nconst redis_ds_RECENT = 'ds_RECENT';\nconst redis_ds_COUNT = 'ds_COUNT';\nconst redis_ds_QUERY = 'ds_QUERY';\n\nconst config = {client: null};\n\nfunction emptyFn() {}\n\nfunction doUpdate(logItem, fn) {\n  const client = getClient();\n  const serializedItem = JSON.stringify(logItem);\n\n  client.watch(redis_ds_COUNT);\n  client.get(redis_ds_COUNT, (err, count) => {\n    if(err) {\n      process.nextTick(doUpdate);\n    }\n    else {\n      count = count ? count : 1;\n      let key = `${redis_ds_QUERY}:${count}`;\n      client.multi()\n        .incr(redis_ds_COUNT)\n        .lpush(redis_ds_RECENT, count)\n        .set(key, serializedItem)\n        .exec((err, reply) => {\n          // Will return null if WATCH fails\n          // http://redis.io/commands/exec\n          if(typeof reply == 'null') {\n            process.nextTick(doUpdate);\n          }\n          else {\n            fn(null, reply);\n          }\n        });\n    }\n  });\n}\n\nfunction getClient() {\n  return config.client;\n}\n\nfunction getRecent(next = emptyFn) {\n  getClient().lrange(redis_ds_RECENT, 0, 9, (err, reply) => {\n    if(err) {\n      next(err);\n      return;\n    }\n\n    // Each stored value is serialized to JSON\n    getClient().mget(reply.map(v => `${redis_ds_QUERY}:${v}`), (err, vals) => {\n      vals = vals ? vals : [];\n      next(null, vals.map(v => JSON.parse(v)));\n    });\n  });\n}\n\nfunction saveRecent(query, next = emptyFn) {\n  const logItem = objectAssign({}, {query, when: Date.now()});\n  doUpdate(logItem, next);\n}\n\nmodule.exports = function({client = null} = {}) {\n  objectAssign(config, {client});\n\n  return {\n    getClient,\n    getRecent,\n    saveRecent\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/search.js","const R = require('ramda');\n\n// https://github.com/ramda/ramda/wiki/Cookbook#rename-keys-of-an-object\nconst renameKeys = R.curry((keysMap, obj) => {\n  return R.reduce((acc, key) => {\n    acc[keysMap[key] || key] = obj[key];\n    return acc;\n  }, {}, R.keys(obj));\n});\n\nmodule.exports = {renameKeys};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/index.js","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"querystring\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"querystring\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 13\n// module chunks = 0","const dotenv = require('dotenv');\n// Only works when loaded here\nif(process.env.NODE_ENV != 'production')\n  dotenv.load();\n\nrequire('./server/app')();\n\n\n\n// WEBPACK FOOTER //\n// ./app.js"],"sourceRoot":""}